<div class="container mt-5" infinite-scroll (scrolled)="onScroll()">
    <div class="grid">
        <!-- Main Content -->
        <div class="col-12 lg:col-8">
            <div class="card border-none mb-3">
                <div class="flex mx-3 md:mx-4 my-3 md:my-5">
                    <div class="max-w-max" *ngIf="loadingImg">
                        <img class="border-circle w-10 h-3rem w-3rem" style="object-fit: cover"
                            src="{{fileLink}}{{myFileId}}" alt="profile picture">
                    </div>
                    <div class="w-full ml-4">
                        <button pButton
                            class="p-button-rounded p-button-outlined p-button-sm w-full text-gray-500 hover:bg-gray-200"
                            (click)="showCreatePostDialog()">Start a Post</button>
                    </div>
                </div>
            </div>

            <p-tabView (onChange)="clickTab($event)">
                <p-tabPanel header="Post" headerStyleClass="w-full">
                    <div class="card border-none" *ngIf="dataEmpty && !postLoading">
                        <div class="flex justify-content-center">
                            <img src="../../../assets/images/empty_ilustration.png" class="w-12rem p-5"
                                alt="empty state">
                        </div>
                        <div class="text-center mb-6">
                            <h6>It's empty in here</h6>
                            <p class="text-sm">your post and other people post will be displayed here</p>
                        </div>
                    </div>

                    <ng-container *ngFor="let data of result; index as i">
                        <div class="card border-none mb-3">
                            <ng-container *ngIf="premiumPostCode==data.postTypeCode && myUserIsPremium==false">
                                <div class="absolute w-full bottom-0 flex justify-content-center align-items-center z-5 cursor-pointer"
                                    style="height: 80%" (click)="showPremiumDoalog()"></div>
                            </ng-container>

                            <div class="card-container p-3 md:p-4">
                                <div class="flex mt-2">
                                    <div class="max-w-max mr-3"><img class="border-circle w-3rem h-3rem"
                                            style="object-fit: cover" src="{{fileLink}}{{data.fileId}}"
                                            alt="profile-picture">
                                    </div>
                                    <div class="w-full">
                                        <h6 class="mb-0">{{data.creatorName}}</h6>
                                        <span class="text-xs">{{data.createdAt | timeAgo}}</span>
                                    </div>
                                    <div class="w-full text-end hidden sm:block">
                                        <span
                                            class="px-1 font-medium bg-yellow-50 text-yellow-500 border-round-md text-xs pb-1">
                                            {{data.positionName}}</span>
                                        <span
                                            class="px-1 font-medium bg-red-50 text-red-500 text-xs mr-1 border-round-md pb-1">{{data.company}}
                                        </span>
                                    </div>
                                    <ng-container *ngIf="data.postTypeCode == premiumPostCode;">
                                        <div class="text-end">
                                            <li class="pi pi-star-fill text-yellow-500" style="font-size: 24px"></li>
                                        </div>
                                    </ng-container>
                                    <ng-container *ngIf="data.userId == myUserId">
                                        <div class="inline-block justify-content-end">
                                            <div class="flex align-items-center text-900 cursor-pointer"
                                                pStyleClass="@next" enterClass="hidden" leaveToClass="hidden"
                                                [hideOnOutsideClick]="true">
                                                <div class="cursor-pointer p-0 ml-2">
                                                    <i class="pi pi-ellipsis-v"></i>
                                                </div>
                                            </div>
                                            <div
                                                class="absolute right-0 py-1 shadow-2 border-round-lg w-12rem bg-white hidden">
                                                <ul class="list-none p-0 m-0">
                                                    <li>
                                                        <a
                                                            class="block px-3 pt-2 pb-2 no-underline text-black-alpha-60 hover:bg-gray-100 transition-all transition-duration-200 cursor-pointer">
                                                            <!-- routerLink=" /feed/edit-post/{{data.id}} -->
                                                            <span class="font-medium" (click)="showEditPost()">Edit
                                                                Post</span>
                                                        </a>
                                                    </li>
                                                    <li>
                                                        <a class="block px-3 pt-2 pb-2 no-underline text-black-alpha-60 hover:bg-gray-100 transition-all transition-duration-200 cursor-pointer"
                                                            (click)="clickConfirmDelete(i)">
                                                            <span class="font-medium">Delete Post</span>
                                                        </a>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </ng-container>
                                </div>
                                <div class="mt-4">
                                    <p class="text-lg font-semibold mb-1">{{data.postTitle}}</p>
                                </div>
                                <ng-container
                                    *ngIf="data.postTypeCode == premiumPostCode && myUserIsPremium==false; else contentRegular">
                                    <div class="w-full" style="filter: blur(2px)">
                                        <p class="text-sm">{{data.postContent}}</p>
                                    </div>
                                </ng-container>
                                <ng-template #contentRegular>
                                    <div class="w-full">
                                        <p class="text-sm">{{data.postContent}}</p>
                                    </div>
                                </ng-template>

                                <div class="mt-3">
                                    <div class="flex w-full column-gap-1">
                                        <ng-container *ngIf="pollPostCode!=data.postTypeCode; else elsePoll">
                                            <ng-container
                                                *ngIf="data.postTypeCode == premiumPostCode && myUserIsPremium==false; else attacmentRegular">
                                                <div class="flex w-full column-gap-1" style="filter: blur(12px)">
                                                    <p-galleria [value]="data.attachmentPostDatas"
                                                        [(visible)]="data.showImg" [(activeIndex)]="activeIndex"
                                                        [containerStyle]="{'max-width': '850px'}" [numVisible]="7"
                                                        [circular]="true" [fullScreen]="true"
                                                        [showItemNavigators]="true" [showThumbnails]="true"
                                                        [baseZIndex]="100000" class="cursor-pointer">
                                                        <ng-template pTemplate="item" let-item>
                                                            <img src={{fileLink}}{{item.fileId}}
                                                                style="width: 100%; display: block;" />
                                                        </ng-template>
                                                        <ng-template pTemplate="thumbnail" let-item>
                                                            <div class="grid grid-nogutter justify-content-center">
                                                                <img src={{fileLink}}{{item.fileId}}
                                                                    style="width: 100%; display: block;" />
                                                            </div>
                                                        </ng-template>
                                                    </p-galleria>

                                                    <ng-container
                                                        *ngFor="let attach of data.attachmentPostDatas ; index as j">
                                                        <ng-container *ngIf="data.attachmentPostDatas.length == 1">
                                                            <div class="col-12 flex justify-content-center p-0 m-0">
                                                                <img src={{fileLink}}{{attach.fileId}} alt="image"
                                                                    class="w-full md:w-20rem h-10rem cursor-pointer"
                                                                    style="object-fit: cover"
                                                                    (click)="imageClick(i,j)" />
                                                            </div>
                                                        </ng-container>

                                                        <ng-container *ngIf="data.attachmentPostDatas.length == 2">
                                                            <div class="col-6 flex p-0">
                                                                <img src={{fileLink}}{{attach.fileId}} alt="image"
                                                                    class="w-full h-12rem cursor-pointer"
                                                                    style="object-fit: cover"
                                                                    (click)="imageClick(i,j)" />
                                                            </div>
                                                        </ng-container>
                                                        <ng-container *ngIf="data.attachmentPostDatas.length == 3">
                                                            <div class="w-full flex">
                                                                <img src={{fileLink}}{{attach.fileId}} alt="image"
                                                                    class="w-full h-12rem cursor-pointer"
                                                                    style="object-fit: cover"
                                                                    (click)="imageClick(i,j)" />
                                                            </div>
                                                        </ng-container>
                                                        <ng-container *ngIf="data.attachmentPostDatas.length > 3">
                                                            <ng-container *ngIf="j == 2; else elsePict">
                                                                <div
                                                                    class="w-full flex justify-content-center align-content-center overflow-hidden pb-1 relative">
                                                                    <img src={{fileLink}}{{attach.fileId}} alt="image"
                                                                        class="w-full h-12rem cursor-pointer"
                                                                        style="object-fit: cover"
                                                                        (click)="imageClick(i,j)" />
                                                                    <div class="absolute w-full h-full bg-black-alpha-90 opacity-80 flex justify-content-center align-items-center"
                                                                        (click)="imageClick(i,j)">
                                                                        <h1 class="text-white">
                                                                            {{data.attachmentPostDatas.length -2}} +
                                                                        </h1>
                                                                    </div>
                                                                </div>
                                                            </ng-container>
                                                            <ng-template #elsePict>
                                                                <div *ngIf=" j<=2"
                                                                    class="w-full flex justify-content-center align-content-center overflow-hidden pb-1 relative">
                                                                    <img src={{fileLink}}{{attach.fileId}} alt="image"
                                                                        class="w-full h-12rem cursor-pointer"
                                                                        style="object-fit: cover"
                                                                        (click)="imageClick(i,j)" />
                                                                </div>
                                                            </ng-template>
                                                        </ng-container>
                                                    </ng-container>
                                                </div>
                                            </ng-container>
                                            <ng-template #attacmentRegular>
                                                <div class="flex w-full column-gap-1">
                                                    <p-galleria [value]="data.attachmentPostDatas"
                                                        [(visible)]="data.showImg" [(activeIndex)]="activeIndex"
                                                        [containerStyle]="{'max-width': '850px'}" [numVisible]="7"
                                                        [circular]="true" [fullScreen]="true"
                                                        [showItemNavigators]="true" [showThumbnails]="false"
                                                        [baseZIndex]="100000" class="cursor-pointer">
                                                        <ng-template pTemplate="item" let-item>
                                                            <img src={{fileLink}}{{item.fileId}}
                                                                style="height: 100vh; width: fit-content; object-fit: fill; display: block;" />
                                                        </ng-template>
                                                    </p-galleria>

                                                    <ng-container
                                                        *ngFor="let attach of data.attachmentPostDatas ; index as j">
                                                        <ng-container *ngIf="data.attachmentPostDatas.length == 1">
                                                            <div class="col-12 flex justify-content-center p-0 m-0">
                                                                <img src={{fileLink}}{{attach.fileId}} alt="image"
                                                                    class="w-full md:w-20rem h-10rem cursor-pointer"
                                                                    style="object-fit: cover"
                                                                    (click)="imageClick(i,j)" />
                                                            </div>
                                                        </ng-container>

                                                        <ng-container *ngIf="data.attachmentPostDatas.length == 2">
                                                            <div class="col-6 flex p-0">
                                                                <img src={{fileLink}}{{attach.fileId}} alt="image"
                                                                    class="w-full h-12rem cursor-pointer"
                                                                    style="object-fit: cover"
                                                                    (click)="imageClick(i,j)" />
                                                            </div>
                                                        </ng-container>
                                                        <ng-container *ngIf="data.attachmentPostDatas.length == 3">
                                                            <div class="w-full flex">
                                                                <img src={{fileLink}}{{attach.fileId}} alt="image"
                                                                    class="w-full h-12rem cursor-pointer"
                                                                    style="object-fit: cover"
                                                                    (click)="imageClick(i,j)" />
                                                            </div>
                                                        </ng-container>
                                                        <ng-container *ngIf="data.attachmentPostDatas.length > 3">
                                                            <ng-container *ngIf="j == 2; else elsePict">
                                                                <div
                                                                    class="w-full flex justify-content-center align-content-center overflow-hidden pb-1 relative">
                                                                    <img src={{fileLink}}{{attach.fileId}} alt="image"
                                                                        class="w-full h-12rem cursor-pointer"
                                                                        style="object-fit: cover"
                                                                        (click)="imageClick(i,j)" />
                                                                    <div class="absolute w-full h-full bg-black-alpha-90 opacity-80 flex justify-content-center align-items-center"
                                                                        (click)="imageClick(i,j)">
                                                                        <h1 class="text-white">
                                                                            {{data.attachmentPostDatas.length -2}} +
                                                                        </h1>
                                                                    </div>
                                                                </div>
                                                            </ng-container>
                                                            <ng-template #elsePict>
                                                                <div *ngIf=" j<=2"
                                                                    class="w-full flex justify-content-center align-content-center overflow-hidden pb-1 relative">
                                                                    <img src={{fileLink}}{{attach.fileId}} alt="image"
                                                                        class="w-full h-12rem cursor-pointer"
                                                                        style="object-fit: cover"
                                                                        (click)="imageClick(i,j)" />
                                                                </div>
                                                            </ng-template>
                                                        </ng-container>
                                                    </ng-container>
                                                </div>
                                            </ng-template>
                                        </ng-container>
                                    </div>

                                    <ng-template #elsePoll>
                                        <div class="mt-3 w-full">
                                            <div class="card p-3 border-none bg-gray-50">
                                                <h6 class="mb-4">{{data.pollData.pollTitle}}</h6>
                                                <ng-container
                                                    *ngIf="data.pollData.isVoted || isExpired(data.pollData.endAt); else notVoted">
                                                    <ng-container
                                                        *ngFor="let poll of data.pollData.pollOptionDatas; index as pollIndex">
                                                        <div class="mt-1 md:mt-3">
                                                            {{poll.pollContent}} | votes: ({{poll.countVote}})
                                                        </div>
                                                        <ng-container *ngIf="poll.isVoted; else optionNotVoted">
                                                            <p-progressBar styleClass="h-2rem"
                                                                [value]="pollValue(poll, data.pollData)"
                                                                class="customProgressBar">
                                                            </p-progressBar>
                                                        </ng-container>
                                                        <ng-template #optionNotVoted>
                                                            <p-progressBar styleClass="h-2rem"
                                                                [value]="pollValue(poll, data.pollData)"
                                                                class="customProgressBarReg">
                                                            </p-progressBar>
                                                        </ng-template>
                                                    </ng-container>
                                                </ng-container>
                                                <ng-template #notVoted>
                                                    <ng-container
                                                        *ngFor="let poll of data.pollData.pollOptionDatas; index as pollIndex">
                                                        <button pButton class="p-button-outlined p-button-sm mb-2"
                                                            type="button" label={{poll.pollContent}}
                                                            (click)="clickVote(i,pollIndex)"></button>
                                                    </ng-container>
                                                </ng-template>
                                                <div class="mt-2">
                                                    <span class="text-sm mr-3">{{data.pollData.countVote}} votes</span>
                                                    <span class="text-end text-sm">Until 5 Day</span>
                                                </div>
                                            </div>
                                        </div>
                                    </ng-template>
                                </div>

                                <div class="grid mt-2">
                                    <div class="col-6">{{data.countLike}} Likes</div>
                                    <div class="col-6 text-end text-sm">{{data.countComment}} Comments</div>
                                </div>
                                <div class="grid border-top-1 border-gray-300 pt-2">
                                    <ng-container *ngIf="data.isLiked ;else elseBlock">
                                        <div class="px-3 py-3 hover:bg-blue-50 flex align-items-center cursor-pointer"
                                            (click)="clickUnLike(i)">
                                            <span class="font-semibold color-primary text-sm hidden sm:block"><i
                                                    class="pi pi-thumbs-up-fill"></i> Like</span>
                                            <i class="pi pi-thumbs-up-fill color-primary block sm:hidden"></i>
                                        </div>

                                    </ng-container>
                                    <ng-template #elseBlock>
                                        <div class="px-3 py-3 hover:bg-blue-50 flex align-items-center border-round-md cursor-pointer"
                                            (click)="clickLike(i)">
                                            <span class="font-semibold hidden sm:block"><i class="pi pi-thumbs-up"></i>
                                                Like</span>
                                            <i class="pi pi-thumbs-up block sm:hidden"></i>
                                        </div>
                                    </ng-template>

                                    <ng-container *ngIf="data.isBookmarked; else notBookmarked">
                                        <div class="px-3 py-3 hover:bg-blue-50 flex align-items-center cursor-pointer"
                                            (click)="clickUnSave(i)">
                                            <span class="font-semibold color-primary hidden sm:block"><i
                                                    class="pi pi-bookmark-fill"></i>
                                                Save</span>
                                            <i class="pi pi-bookmark-fill color-primary block sm:hidden"></i>
                                        </div>
                                    </ng-container>
                                    <ng-template #notBookmarked>
                                        <div class="px-3 py-3 hover:bg-blue-50 flex align-items-center cursor-pointer"
                                            (click)="clickSave(i)">
                                            <span class="font-semibold hidden sm:block"><i class="pi pi-bookmark"></i>
                                                Save</span>
                                            <i class="pi pi-bookmark  block sm:hidden"></i>
                                        </div>

                                    </ng-template>
                                    <div class="px-3 py-3 hover:bg-blue-50 flex align-items-center cursor-pointer"
                                        (click)="clickCommentPost(i)">
                                        <span class="font-semibold hidden sm:block"><i class="pi pi-comment"></i>
                                            Comment</span>
                                        <i class="pi pi-comment  block sm:hidden"></i>
                                    </div>
                                </div>
                                <div *ngIf="data.commentStatus">
                                    <div class="flex mt-2">
                                        <div class="max-w-max mr-3"><img src="{{fileLink}}{{myFileId}}"
                                                class="border-circle w-2rem h-2rem" style="object-fit: cover"
                                                alt="profile picture">
                                        </div>
                                        <div class="w-full">
                                            <form [formGroup]="commentForm"
                                                (ngSubmit)="commentForm.valid && submitcomment(i)">
                                                <div class="flex flex-row align-content-center">
                                                    <input pInputText pAutoFocus
                                                        class="w-full p-inputtext-sm border-round-3xl text-sm"
                                                        [autofocus]="true" placeholder="Write a comment..."
                                                        formControlName="commentContent">
                                                    <p-button type="submit" class="ml-2" [hidden]="true">Send</p-button>
                                                </div>
                                                <small class="text-xs">Press enter to comment</small>
                                            </form>
                                        </div>
                                    </div>
                                    <div class="my-3">
                                        <span class="text-sm cursor-pointer hover:text-blue-500"
                                            *ngIf="data.moreComment==false" (click)="clickSeeComment(i)">
                                            View Comments
                                        </span>
                                        <span class="text-sm cursor-pointer hover:text-blue-500"
                                            *ngIf="data.moreComment" (click)="clickCloseComment(i)">
                                            Close Comments
                                        </span>
                                    </div>

                                    <div *ngIf="data.moreComment">
                                        <ng-container *ngFor="let comment of data.commentDatas; index as commentIndex">
                                            <ng-container *ngIf="!comment.editComment; else elseEditComment">
                                                <div class="flex mt-2">
                                                    <div class="max-w-max mr-3"> <img
                                                            class="border-circle w-2rem h-2rem"
                                                            style="object-fit: cover"
                                                            src="{{fileLink}}{{comment.fileId}}" alt="">
                                                    </div>
                                                    <div class="card border-none bg-gray-50 border-round-md py-1">
                                                        <div class="flex px-3">
                                                            <div class="w-full">
                                                                <p class="font-medium text-sm mb-0">{{comment.userName}}
                                                                </p>
                                                                <span class="text-xs">{{comment.createdAt |
                                                                    timeAgo}}</span>
                                                            </div>
                                                            <div class="inline-block justify-content-end relative ml-6"
                                                                *ngIf="data.userId==myUserId || comment.userId == myUserId">
                                                                <div class="flex align-items-center text-900 cursor-pointer hover:bg-gray-100"
                                                                    pStyleClass="@next" enterClass="hidden"
                                                                    leaveToClass="hidden" [hideOnOutsideClick]="true">
                                                                    <div
                                                                        class="cursor-pointer transition-all transition-duration-200">
                                                                        <i class="pi pi-ellipsis-h"></i>
                                                                    </div>
                                                                </div>
                                                                <div
                                                                    class="absolute right-0 shadow-2 border-round-lg w-12rem z-5 bg-white hidden">
                                                                    <ul class="list-none p-0 m-0">
                                                                        <li>
                                                                            <a *ngIf="comment.userId == myUserId && !editComment"
                                                                                class="block px-3 pt-2 pb-2 no-underline text-black-alpha-60 hover:bg-gray-100 hover:border-round-top-lg transition-all transition-duration-200 cursor-pointer"
                                                                                (click)="clickEditComment(i, commentIndex)">
                                                                                <span class="font-medium">Edit</span>
                                                                            </a>
                                                                        </li>
                                                                        <li>
                                                                            <a *ngIf="comment.userId == myUserId || data.userId==myUserId"
                                                                                class="block px-3 pt-2 pb-2 no-underline text-black-alpha-60 hover:bg-gray-100 hover:border-round-bottom-lg transition-all transition-duration-200 cursor-pointer"
                                                                                (click)="clickConfirmDeleteComment(i, commentIndex)">
                                                                                <span class="font-medium">Delete</span>
                                                                            </a>
                                                                        </li>
                                                                    </ul>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="px-3 mt-2">
                                                            <p class="text-sm mb-1 line-height-2">
                                                                {{comment.commentContent}} <em
                                                                    *ngIf="comment.version>0"><small>(edited)</small></em>
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </ng-container>
                                            <ng-template #elseEditComment>
                                                <div class="flex mt-2" *ngIf="comment.editComment">
                                                    <div class="max-w-max mr-3"><img src="{{fileLink}}{{myFileId}}"
                                                            class="border-circle w-2rem h-2rem"
                                                            style="object-fit: cover" alt="profile picture">
                                                    </div>
                                                    <div class="w-full">
                                                        <form [formGroup]="updateCommentForm"
                                                            (ngSubmit)="updateCommentForm.valid && submitEditComment(i, commentIndex)">
                                                            <div class="flex flex-row align-content-center">
                                                                <input pInputText pAutoFocus
                                                                    class="w-full p-inputtext-sm border-round-3xl text-sm"
                                                                    [autofocus]="true" placeholder="Edit comment..."
                                                                    formControlName="commentContent">
                                                                <p-button type="submit" class="ml-2" [hidden]="true">
                                                                    Send
                                                                </p-button>
                                                            </div>
                                                            <small class="text-xs">Press enter to edit comment. Click
                                                                here to
                                                                <a class="text-primary cursor-pointer font-medium"
                                                                    style="text-decoration: none;"
                                                                    (click)="cancelEdit(i, commentIndex)">Cancel</a></small>
                                                        </form>
                                                    </div>
                                                </div>
                                            </ng-template>
                                        </ng-container>
                                        <span class="text-sm cursor-pointer hover:text-blue-500 mt-2"
                                            *ngIf="data.showMoreComment" (click)="seeMoreComment(i)">
                                            See More...
                                        </span>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </ng-container>

                    <div class="text-center" *ngIf="postLoading">
                        <p-progressSpinner></p-progressSpinner>
                    </div>

                </p-tabPanel>

                <p-tabPanel header="Likes" headerStyleClass="w-full">
                    <!-- Likes -->
                    <div class="card border-none" *ngIf="dataEmpty && !postLoading">
                        <div class="flex justify-content-center">
                            <img src="../../../assets/images/empty_ilustration.png" class="w-12rem p-5"
                                alt="empty state">
                        </div>
                        <div class="text-center mb-6">
                            <h6>It's empty in here</h6>
                            <p class="text-sm">Posts that you like will be displayed here</p>
                        </div>
                    </div>

                    <ng-container *ngFor="let data of result; index as i">
                        <div class="card border-none mb-3">
                            <ng-container *ngIf="premiumPostCode==data.postTypeCode && myUserIsPremium==false">
                                <div class="absolute w-full bottom-0 flex justify-content-center align-items-center z-5 cursor-pointer"
                                    style="height: 80%" (click)="showPremiumDoalog()"></div>
                            </ng-container>

                            <div class="card-container p-3 md:p-4">
                                <div class="flex mt-2">
                                    <div class="max-w-max mr-3"><img class="border-circle w-3rem h-3rem"
                                            style="object-fit: cover" src="{{fileLink}}{{data.fileId}}"
                                            alt="profile-picture">
                                    </div>
                                    <div class="w-full">
                                        <h6 class="mb-0">{{data.creatorName}}</h6>
                                        <span class="text-xs">{{data.createdAt | timeAgo}}</span>
                                    </div>
                                    <div class="w-full text-end">
                                        <span
                                            class="px-1 font-medium bg-yellow-50 text-yellow-500 border-round-md text-xs pb-1">
                                            {{data.positionName}}</span>
                                        <span
                                            class="px-1 font-medium bg-red-50 text-red-500 text-xs mr-1 border-round-md pb-1">{{data.company}}
                                        </span>
                                    </div>
                                    <ng-container *ngIf="data.postTypeCode == premiumPostCode;">
                                        <div class="text-end">
                                            <li class="pi pi-star-fill text-yellow-500" style="font-size: 25px"></li>
                                        </div>
                                    </ng-container>
                                    <ng-container *ngIf="data.userId == myUserId">
                                        <div class="inline-block justify-content-end">
                                            <div class="flex align-items-center text-900 cursor-pointer hover:bg-gray-100"
                                                pStyleClass="@next" enterClass="hidden" leaveToClass="hidden"
                                                [hideOnOutsideClick]="true">
                                                <div
                                                    class="cursor-pointer hover:bg-gray-100 transition-all transition-duration-200 px-3 py-2">
                                                    <i class="pi pi-ellipsis-v"></i>
                                                </div>
                                            </div>
                                            <div
                                                class="absolute right-0 py-1 shadow-2 border-round-lg w-12rem bg-white hidden">
                                                <ul class="list-none p-0 m-0">
                                                    <li>
                                                        <a class="block px-3 pt-2 pb-2 no-underline text-black-alpha-60 hover:bg-gray-100 transition-all transition-duration-200 cursor-pointer"
                                                            routerLink="/feed/edit-post/{{data.id}}">
                                                            <span class="font-medium">Edit Post</span>
                                                        </a>
                                                    </li>
                                                    <li>
                                                        <a class="block px-3 pt-2 pb-2 no-underline text-black-alpha-60 hover:bg-gray-100 transition-all transition-duration-200 cursor-pointer"
                                                            (click)="clickConfirmDelete(i)">
                                                            <span class="font-medium">Delete Post</span>
                                                        </a>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </ng-container>
                                </div>
                                <div class="mt-4">
                                    <p class="text-lg font-semibold mb-1">{{data.postTitle}}</p>
                                </div>
                                <ng-container
                                    *ngIf="data.postTypeCode == premiumPostCode && myUserIsPremium==false; else contentRegular">
                                    <div class="w-full" style="filter: blur(2px)">
                                        <p class="text-sm">{{data.postContent}}</p>
                                    </div>
                                </ng-container>
                                <ng-template #contentRegular>
                                    <div class="w-full">
                                        <p class="text-sm">{{data.postContent}}</p>
                                    </div>
                                </ng-template>

                                <div class="mt-3">
                                    <div class="flex w-full column-gap-1">
                                        <ng-container *ngIf="pollPostCode!=data.postTypeCode; else elsePoll">
                                            <ng-container
                                                *ngIf="data.postTypeCode == premiumPostCode && myUserIsPremium==false; else attacmentRegular">
                                                <div class="flex w-full column-gap-1" style="filter: blur(12px)">
                                                    <p-galleria [value]="data.attachmentPostDatas"
                                                        [(visible)]="data.showImg" [(activeIndex)]="activeIndex"
                                                        [containerStyle]="{'max-width': '850px'}" [numVisible]="7"
                                                        [circular]="true" [fullScreen]="true"
                                                        [showItemNavigators]="true" [showThumbnails]="true"
                                                        [baseZIndex]="100000" class="cursor-pointer">
                                                        <ng-template pTemplate="item" let-item>
                                                            <img src={{fileLink}}{{item.fileId}}
                                                                style="width: 100%; display: block;" />
                                                        </ng-template>
                                                        <ng-template pTemplate="thumbnail" let-item>
                                                            <div class="grid grid-nogutter justify-content-center">
                                                                <img src={{fileLink}}{{item.fileId}}
                                                                    style="width: 100%; display: block;" />
                                                            </div>
                                                        </ng-template>
                                                    </p-galleria>

                                                    <ng-container
                                                        *ngFor="let attach of data.attachmentPostDatas ; index as j">
                                                        <ng-container *ngIf="data.attachmentPostDatas.length == 1">
                                                            <img src={{fileLink}}{{attach.fileId}} alt="image"
                                                                class="w-full h-15rem cursor-pointer"
                                                                style="object-fit: contain" (click)="imageClick(i,j)" />
                                                        </ng-container>

                                                        <ng-container *ngIf="data.attachmentPostDatas.length == 2">
                                                            <div class="w-full flex">
                                                                <img src={{fileLink}}{{attach.fileId}} alt="image"
                                                                    class="w-full h-15rem cursor-pointer"
                                                                    style="object-fit: contain"
                                                                    (click)="imageClick(i,j)" />
                                                            </div>
                                                        </ng-container>
                                                        <ng-container *ngIf="data.attachmentPostDatas.length == 3">
                                                            <div class="w-full flex">
                                                                <img src={{fileLink}}{{attach.fileId}} alt="image"
                                                                    class="w-full h-12rem cursor-pointer"
                                                                    style="object-fit: contain"
                                                                    (click)="imageClick(i,j)" />
                                                            </div>
                                                        </ng-container>
                                                        <ng-container *ngIf="data.attachmentPostDatas.length > 3">
                                                            <ng-container *ngIf="j == 3; else elsePict">
                                                                <div
                                                                    class="w-full flex justify-content-center align-content-center h-15rem overflow-hidden pb-1 relative">
                                                                    <img src={{fileLink}}{{attach.fileId}} alt="image"
                                                                        class="h-auto cursor-pointer"
                                                                        style="object-fit: cover"
                                                                        (click)="imageClick(i,j)" />
                                                                    <div class="absolute w-full h-full bg-black-alpha-90 opacity-80 flex justify-content-center align-items-center"
                                                                        (click)="imageClick(i,j)">
                                                                        <h1 class="text-white">
                                                                            {{data.attachmentPostDatas.length -3}} +
                                                                        </h1>
                                                                    </div>
                                                                </div>
                                                            </ng-container>
                                                            <ng-template #elsePict>
                                                                <div *ngIf=" j<=3"
                                                                    class="w-full flex justify-content-center align-content-center h-15rem overflow-hidden pb-1 relative">
                                                                    <img src={{fileLink}}{{attach.fileId}} alt="image"
                                                                        class="h-auto cursor-pointer"
                                                                        style="object-fit: cover"
                                                                        (click)="imageClick(i,j)" />
                                                                </div>
                                                            </ng-template>
                                                        </ng-container>
                                                    </ng-container>
                                                </div>
                                            </ng-container>
                                            <ng-template #attacmentRegular>
                                                <div class="flex w-full column-gap-1">
                                                    <p-galleria [value]="data.attachmentPostDatas"
                                                        [(visible)]="data.showImg" [(activeIndex)]="activeIndex"
                                                        [containerStyle]="{'max-width': '850px'}" [numVisible]="7"
                                                        [circular]="true" [fullScreen]="true"
                                                        [showItemNavigators]="true" [showThumbnails]="false"
                                                        [baseZIndex]="100000" class="cursor-pointer">
                                                        <ng-template pTemplate="item" let-item>
                                                            <img src={{fileLink}}{{item.fileId}}
                                                                style="height: 100vh; width: fit-content; object-fit: fill; display: block;" />
                                                        </ng-template>
                                                    </p-galleria>

                                                    <ng-container
                                                        *ngFor="let attach of data.attachmentPostDatas ; index as j">
                                                        <ng-container *ngIf="data.attachmentPostDatas.length == 1">
                                                            <img src={{fileLink}}{{attach.fileId}} alt="image"
                                                                class="w-full h-20rem cursor-pointer"
                                                                style="object-fit: cover" (click)="imageClick(i,j)" />
                                                        </ng-container>

                                                        <ng-container *ngIf="data.attachmentPostDatas.length == 2">
                                                            <div class="w-full flex">
                                                                <img src={{fileLink}}{{attach.fileId}} alt="image"
                                                                    class="w-full h-15rem cursor-pointer"
                                                                    style="object-fit: contain"
                                                                    (click)="imageClick(i,j)" />
                                                            </div>
                                                        </ng-container>
                                                        <ng-container *ngIf="data.attachmentPostDatas.length == 3">
                                                            <div class="w-full flex">
                                                                <img src={{fileLink}}{{attach.fileId}} alt="image"
                                                                    class="w-full h-12rem cursor-pointer"
                                                                    style="object-fit: contain"
                                                                    (click)="imageClick(i,j)" />
                                                            </div>
                                                        </ng-container>
                                                        <ng-container *ngIf="data.attachmentPostDatas.length > 3">
                                                            <ng-container *ngIf="j == 3; else elsePict">
                                                                <div
                                                                    class="w-full flex justify-content-center align-content-center h-10rem overflow-hidden pb-1 relative">
                                                                    <img src={{fileLink}}{{attach.fileId}} alt="image"
                                                                        class="h-auto cursor-pointer"
                                                                        style="object-fit: cover"
                                                                        (click)="imageClick(i,j)" />
                                                                    <div class="absolute w-full h-full bg-black-alpha-90 opacity-80 flex justify-content-center align-items-center"
                                                                        (click)="imageClick(i,j)">
                                                                        <h1 class="text-white">
                                                                            {{data.attachmentPostDatas.length -3}} +
                                                                        </h1>
                                                                    </div>
                                                                </div>
                                                            </ng-container>
                                                            <ng-template #elsePict>
                                                                <div *ngIf=" j<=3"
                                                                    class="w-full flex justify-content-center align-content-center h-10rem overflow-hidden pb-1 relative">
                                                                    <img src={{fileLink}}{{attach.fileId}} alt="image"
                                                                        class="h-auto cursor-pointer"
                                                                        style="object-fit: cover"
                                                                        (click)="imageClick(i,j)" />
                                                                </div>
                                                            </ng-template>
                                                        </ng-container>
                                                    </ng-container>
                                                </div>
                                            </ng-template>
                                        </ng-container>
                                    </div>

                                    <ng-template #elsePoll>
                                        <div class="mt-3 w-full">
                                            <div class="card p-4 border-none bg-gray-50">
                                                <h6 class="mb-4">{{data.pollData.pollTitle}}</h6>
                                                <ng-container
                                                    *ngIf="data.pollData.isVoted || isExpired(data.pollData.endAt); else notVoted">
                                                    <ng-container
                                                        *ngFor="let poll of data.pollData.pollOptionDatas; index as pollIndex">
                                                        <ng-container *ngIf="poll.isVoted; else optionNotVoted">
                                                            <button pButton class="p-button-sm mb-2" type="button"
                                                                label={{poll.pollContent}} [disabled]="true"></button>
                                                        </ng-container>
                                                        <ng-template #optionNotVoted>
                                                            <button pButton class="p-button-outlined p-button-sm mb-2"
                                                                type="button" label={{poll.pollContent}}
                                                                [disabled]="true"></button>
                                                        </ng-template>
                                                    </ng-container>
                                                </ng-container>
                                                <ng-template #notVoted>
                                                    <ng-container
                                                        *ngFor="let poll of data.pollData.pollOptionDatas; index as pollIndex">
                                                        <button pButton class="p-button-outlined p-button-sm mb-2"
                                                            type="button" label={{poll.pollContent}}
                                                            (click)="clickVote(i,pollIndex)"></button>
                                                    </ng-container>
                                                </ng-template>
                                                <div class="mt-2">
                                                    <span class="text-sm mr-3">{{data.pollData.countVote}} votes</span>
                                                    <span class="text-end text-sm">Until 5 Day</span>
                                                </div>
                                            </div>
                                        </div>
                                    </ng-template>
                                </div>

                                <div class="grid mt-2">
                                    <div class="col-6">{{data.countLike}} Likes</div>
                                    <div class="col-6 text-end text-sm">{{data.countComment}} Comments</div>
                                </div>
                                <div class="grid border-top-1 border-gray-300 pt-2">
                                    <ng-container *ngIf="data.isLiked ;else elseBlock">
                                        <div class="px-3 py-3 hover:bg-blue-50 flex align-items-center cursor-pointer"
                                            (click)="clickUnLike(i)">
                                            <span class="font-semibold color-primary text-sm"><i
                                                    class="pi pi-thumbs-up-fill"></i> Like</span>
                                        </div>

                                    </ng-container>
                                    <ng-template #elseBlock>
                                        <div class="px-3 py-3 hover:bg-blue-50 flex align-items-center border-round-md cursor-pointer"
                                            (click)="clickLike(i)">
                                            <span class="font-semibold text-sm"><i class="pi pi-thumbs-up"></i>
                                                Like</span>
                                        </div>
                                    </ng-template>

                                    <ng-container *ngIf="data.isBookmarked; else notBookmarked">
                                        <div class="px-3 py-3 hover:bg-blue-50 flex align-items-center cursor-pointer"
                                            (click)="clickUnSave(i)">
                                            <span class="font-semibold color-primary"><i
                                                    class="pi pi-bookmark-fill"></i> Save</span>
                                        </div>
                                    </ng-container>
                                    <ng-template #notBookmarked>
                                        <div class="px-3 py-3 hover:bg-blue-50 flex align-items-center cursor-pointer"
                                            (click)="clickSave(i)">
                                            <span class="font-semibold"><i class="pi pi-bookmark"></i> Save</span>
                                        </div>

                                    </ng-template>
                                    <div class="px-3 py-3 hover:bg-blue-50 flex align-items-center cursor-pointer"
                                        (click)="clickCommentPost(i)">
                                        <span class="font-semibold"><i class="pi pi-comment"></i> Comment</span>
                                    </div>
                                </div>
                                <div *ngIf="data.commentStatus">
                                    <div class="flex mt-2">
                                        <div class="max-w-max mr-3"><img src="{{fileLink}}{{myFileId}}"
                                                class="border-circle w-2rem h-2rem" style="object-fit: cover"
                                                alt="profile picture">
                                        </div>
                                        <div class="w-full">
                                            <form [formGroup]="commentForm" (ngSubmit)="submitcomment(i)">
                                                <div class="flex flex-row align-content-center">
                                                    <input pInputText pAutoFocus
                                                        class="w-full p-inputtext-sm border-round-3xl text-sm"
                                                        [autofocus]="true" placeholder="Write a comment..."
                                                        formControlName="commentContent">
                                                    <p-button type="submit" class="ml-2" [hidden]="true">Send</p-button>
                                                </div>
                                                <small class="text-xs">Press enter to comment</small>
                                            </form>
                                        </div>
                                    </div>
                                    <div class="my-3">
                                        <span class="text-sm cursor-pointer hover:text-blue-500"
                                            *ngIf="data.moreComment==false" (click)="clickSeeComment(i)">
                                            View Comments
                                        </span>
                                        <span class="text-sm cursor-pointer hover:text-blue-500"
                                            *ngIf="data.moreComment" (click)="clickCloseComment(i)">
                                            Close Comments
                                        </span>
                                    </div>

                                    <div *ngIf="data.moreComment">
                                        <ng-container *ngFor="let comment of data.commentDatas; index as commentIndex">
                                            <ng-container *ngIf="!comment.editComment; else elseEditComment">
                                                <div class="flex mt-2">
                                                    <div class="max-w-max mr-3"> <img
                                                            class="border-circle w-2rem h-2rem"
                                                            style="object-fit: cover"
                                                            src="{{fileLink}}{{comment.fileId}}" alt="">
                                                    </div>
                                                    <div class="card border-none bg-gray-50 border-round-md py-1">
                                                        <div class="flex px-3">
                                                            <div class="w-full">
                                                                <p class="font-medium text-sm mb-0">{{comment.userName}}
                                                                </p>
                                                                <span class="text-xs">{{comment.createdAt |
                                                                    timeAgo}}</span>
                                                            </div>
                                                            <div class="inline-block justify-content-end relative ml-6"
                                                                *ngIf="data.userId==myUserId || comment.userId == myUserId">
                                                                <div class="flex align-items-center text-900 cursor-pointer hover:bg-gray-100"
                                                                    pStyleClass="@next" enterClass="hidden"
                                                                    leaveToClass="hidden" [hideOnOutsideClick]="true">
                                                                    <div
                                                                        class="cursor-pointer transition-all transition-duration-200">
                                                                        <i class="pi pi-ellipsis-h"></i>
                                                                    </div>
                                                                </div>
                                                                <div
                                                                    class="absolute right-0 shadow-2 border-round-lg w-12rem z-5 bg-white hidden">
                                                                    <ul class="list-none p-0 m-0">
                                                                        <li>
                                                                            <a *ngIf="comment.userId == myUserId && !editComment"
                                                                                class="block px-3 pt-2 pb-2 no-underline text-black-alpha-60 hover:bg-gray-100 hover:border-round-top-lg transition-all transition-duration-200 cursor-pointer"
                                                                                (click)="clickEditComment(i, commentIndex)">
                                                                                <span class="font-medium">Edit</span>
                                                                            </a>
                                                                        </li>
                                                                        <li>
                                                                            <a *ngIf="comment.userId == myUserId || data.userId==myUserId"
                                                                                class="block px-3 pt-2 pb-2 no-underline text-black-alpha-60 hover:bg-gray-100 hover:border-round-bottom-lg transition-all transition-duration-200 cursor-pointer"
                                                                                (click)="clickConfirmDeleteComment(i, commentIndex)">
                                                                                <span class="font-medium">Delete</span>
                                                                            </a>
                                                                        </li>
                                                                    </ul>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="px-3 mt-2">
                                                            <p class="text-sm mb-1 line-height-2">
                                                                {{comment.commentContent}} <em
                                                                    *ngIf="comment.version>0"><small>(edited)</small></em>
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </ng-container>
                                            <ng-template #elseEditComment>
                                                <div class="flex mt-2" *ngIf="comment.editComment">
                                                    <div class="max-w-max mr-3"><img src="{{fileLink}}{{myFileId}}"
                                                            class="border-circle w-2rem h-2rem"
                                                            style="object-fit: cover" alt="profile picture">
                                                    </div>
                                                    <div class="w-full">
                                                        <form [formGroup]="updateCommentForm"
                                                            (ngSubmit)="submitEditComment(i, commentIndex)">
                                                            <div class="flex flex-row align-content-center">
                                                                <input pInputText pAutoFocus
                                                                    class="w-full p-inputtext-sm border-round-3xl text-sm"
                                                                    [autofocus]="true" placeholder="Edit comment..."
                                                                    formControlName="commentContent">
                                                                <p-button type="submit" class="ml-2" [hidden]="true">
                                                                    Send
                                                                </p-button>
                                                            </div>
                                                            <small class="text-xs">Press enter to edit comment. Click
                                                                here to
                                                                <a class="text-primary cursor-pointer font-medium"
                                                                    style="text-decoration: none;"
                                                                    (click)="cancelEdit(i, commentIndex)">Cancel</a></small>
                                                        </form>
                                                    </div>
                                                </div>
                                            </ng-template>
                                        </ng-container>
                                        <span class="text-sm cursor-pointer hover:text-blue-500 mt-2"
                                            *ngIf="data.showMoreComment" (click)="seeMoreComment(i)">
                                            See More...
                                        </span>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </ng-container>

                    <div class="text-center" *ngIf="postLoading">
                        <p-progressSpinner></p-progressSpinner>
                    </div>
                </p-tabPanel>

                <p-tabPanel header="Bookmark" headerStyleClass="w-full">
                    <!-- Bookmark -->
                    <div class="card border-none" *ngIf="dataEmpty && !postLoading">
                        <div class="flex justify-content-center">
                            <img src="../../../assets/images/empty_ilustration.png" class="w-12rem p-5"
                                alt="empty state">
                        </div>
                        <div class="text-center mb-6">
                            <h6>It's empty here</h6>
                            <p class="text-sm">Posts that you save will be displayed here</p>
                        </div>
                    </div>

                    <ng-container *ngFor="let data of result; index as i">
                        <div class="card border-none mb-3">
                            <ng-container *ngIf="premiumPostCode==data.postTypeCode && myUserIsPremium==false">
                                <div class="absolute w-full bottom-0 flex justify-content-center align-items-center z-5 cursor-pointer"
                                    style="height: 80%" (click)="showPremiumDoalog()"></div>
                            </ng-container>

                            <div class="card-container p-3 md:p-4">
                                <div class="flex mt-2">
                                    <div class="max-w-max mr-3"><img class="border-circle w-3rem h-3rem"
                                            style="object-fit: cover" src="{{fileLink}}{{data.fileId}}"
                                            alt="profile-picture">
                                    </div>
                                    <div class="w-full">
                                        <h6 class="mb-0">{{data.creatorName}}</h6>
                                        <span class="text-xs">{{data.createdAt | timeAgo}}</span>
                                    </div>
                                    <div class="w-full text-end">
                                        <span
                                            class="px-1 font-medium bg-yellow-50 text-yellow-500 border-round-md text-xs pb-1">
                                            {{data.positionName}}</span>
                                        <span
                                            class="px-1 font-medium bg-red-50 text-red-500 text-xs mr-1 border-round-md pb-1">{{data.company}}
                                        </span>
                                    </div>
                                    <ng-container *ngIf="data.postTypeCode == premiumPostCode;">
                                        <div class="text-end">
                                            <li class="pi pi-star-fill text-yellow-500" style="font-size: 25px"></li>
                                        </div>
                                    </ng-container>
                                    <ng-container *ngIf="data.userId == myUserId">
                                        <div class="inline-block justify-content-end">
                                            <div class="flex align-items-center text-900 cursor-pointer hover:bg-gray-100"
                                                pStyleClass="@next" enterClass="hidden" leaveToClass="hidden"
                                                [hideOnOutsideClick]="true">
                                                <div
                                                    class="cursor-pointer hover:bg-gray-100 transition-all transition-duration-200 px-3 py-2">
                                                    <i class="pi pi-ellipsis-v"></i>
                                                </div>
                                            </div>
                                            <div
                                                class="absolute right-0 py-1 shadow-2 border-round-lg w-12rem bg-white hidden">
                                                <ul class="list-none p-0 m-0">
                                                    <li>
                                                        <a class="block px-3 pt-2 pb-2 no-underline text-black-alpha-60 hover:bg-gray-100 transition-all transition-duration-200 cursor-pointer"
                                                            routerLink="/feed/edit-post/{{data.id}}">
                                                            <span class="font-medium">Edit Post</span>
                                                        </a>
                                                    </li>
                                                    <li>
                                                        <a class="block px-3 pt-2 pb-2 no-underline text-black-alpha-60 hover:bg-gray-100 transition-all transition-duration-200 cursor-pointer"
                                                            (click)="clickConfirmDelete(i)">
                                                            <span class="font-medium">Delete Post</span>
                                                        </a>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </ng-container>
                                </div>
                                <div class="mt-4">
                                    <p class="text-lg font-semibold mb-1">{{data.postTitle}}</p>
                                </div>
                                <ng-container
                                    *ngIf="data.postTypeCode == premiumPostCode && myUserIsPremium==false; else contentRegular">
                                    <div class="w-full" style="filter: blur(2px)">
                                        <p class="text-sm">{{data.postContent}}</p>
                                    </div>
                                </ng-container>
                                <ng-template #contentRegular>
                                    <div class="w-full">
                                        <p class="text-sm">{{data.postContent}}</p>
                                    </div>
                                </ng-template>

                                <div class="mt-3">
                                    <div class="flex w-full column-gap-1">
                                        <ng-container *ngIf="pollPostCode!=data.postTypeCode; else elsePoll">
                                            <ng-container
                                                *ngIf="data.postTypeCode == premiumPostCode && myUserIsPremium==false; else attacmentRegular">
                                                <div class="flex w-full column-gap-1" style="filter: blur(12px)">
                                                    <p-galleria [value]="data.attachmentPostDatas"
                                                        [(visible)]="data.showImg" [(activeIndex)]="activeIndex"
                                                        [containerStyle]="{'max-width': '850px'}" [numVisible]="7"
                                                        [circular]="true" [fullScreen]="true"
                                                        [showItemNavigators]="true" [showThumbnails]="true"
                                                        [baseZIndex]="100000" class="cursor-pointer">
                                                        <ng-template pTemplate="item" let-item>
                                                            <img src={{fileLink}}{{item.fileId}}
                                                                style="width: 100%; display: block;" />
                                                        </ng-template>
                                                        <ng-template pTemplate="thumbnail" let-item>
                                                            <div class="grid grid-nogutter justify-content-center">
                                                                <img src={{fileLink}}{{item.fileId}}
                                                                    style="width: 100%; display: block;" />
                                                            </div>
                                                        </ng-template>
                                                    </p-galleria>

                                                    <ng-container
                                                        *ngFor="let attach of data.attachmentPostDatas ; index as j">
                                                        <ng-container *ngIf="data.attachmentPostDatas.length == 1">
                                                            <img src={{fileLink}}{{attach.fileId}} alt="image"
                                                                class="w-full h-15rem cursor-pointer"
                                                                style="object-fit: contain" (click)="imageClick(i,j)" />
                                                        </ng-container>

                                                        <ng-container *ngIf="data.attachmentPostDatas.length == 2">
                                                            <div class="w-full flex">
                                                                <img src={{fileLink}}{{attach.fileId}} alt="image"
                                                                    class="w-full h-15rem cursor-pointer"
                                                                    style="object-fit: contain"
                                                                    (click)="imageClick(i,j)" />
                                                            </div>
                                                        </ng-container>
                                                        <ng-container *ngIf="data.attachmentPostDatas.length == 3">
                                                            <div class="w-full flex">
                                                                <img src={{fileLink}}{{attach.fileId}} alt="image"
                                                                    class="w-full h-12rem cursor-pointer"
                                                                    style="object-fit: contain"
                                                                    (click)="imageClick(i,j)" />
                                                            </div>
                                                        </ng-container>
                                                        <ng-container *ngIf="data.attachmentPostDatas.length > 3">
                                                            <ng-container *ngIf="j == 3; else elsePict">
                                                                <div
                                                                    class="w-full flex justify-content-center align-content-center h-15rem overflow-hidden pb-1 relative">
                                                                    <img src={{fileLink}}{{attach.fileId}} alt="image"
                                                                        class="h-auto cursor-pointer"
                                                                        style="object-fit: cover"
                                                                        (click)="imageClick(i,j)" />
                                                                    <div class="absolute w-full h-full bg-black-alpha-90 opacity-80 flex justify-content-center align-items-center"
                                                                        (click)="imageClick(i,j)">
                                                                        <h1 class="text-white">
                                                                            {{data.attachmentPostDatas.length -3}} +
                                                                        </h1>
                                                                    </div>
                                                                </div>
                                                            </ng-container>
                                                            <ng-template #elsePict>
                                                                <div *ngIf=" j<=3"
                                                                    class="w-full flex justify-content-center align-content-center h-15rem overflow-hidden pb-1 relative">
                                                                    <img src={{fileLink}}{{attach.fileId}} alt="image"
                                                                        class="h-auto cursor-pointer"
                                                                        style="object-fit: cover"
                                                                        (click)="imageClick(i,j)" />
                                                                </div>
                                                            </ng-template>
                                                        </ng-container>
                                                    </ng-container>
                                                </div>
                                            </ng-container>
                                            <ng-template #attacmentRegular>
                                                <div class="flex w-full column-gap-1">
                                                    <p-galleria [value]="data.attachmentPostDatas"
                                                        [(visible)]="data.showImg" [(activeIndex)]="activeIndex"
                                                        [containerStyle]="{'max-width': '850px'}" [numVisible]="7"
                                                        [circular]="true" [fullScreen]="true"
                                                        [showItemNavigators]="true" [showThumbnails]="false"
                                                        [baseZIndex]="100000" class="cursor-pointer">
                                                        <ng-template pTemplate="item" let-item>
                                                            <img src={{fileLink}}{{item.fileId}}
                                                                style="height: 100vh; width: fit-content; object-fit: fill; display: block;" />
                                                        </ng-template>
                                                    </p-galleria>

                                                    <ng-container
                                                        *ngFor="let attach of data.attachmentPostDatas ; index as j">
                                                        <ng-container *ngIf="data.attachmentPostDatas.length == 1">
                                                            <img src={{fileLink}}{{attach.fileId}} alt="image"
                                                                class="w-full h-20rem cursor-pointer"
                                                                style="object-fit: cover" (click)="imageClick(i,j)" />
                                                        </ng-container>

                                                        <ng-container *ngIf="data.attachmentPostDatas.length == 2">
                                                            <div class="w-full flex">
                                                                <img src={{fileLink}}{{attach.fileId}} alt="image"
                                                                    class="w-full h-15rem cursor-pointer"
                                                                    style="object-fit: contain"
                                                                    (click)="imageClick(i,j)" />
                                                            </div>
                                                        </ng-container>
                                                        <ng-container *ngIf="data.attachmentPostDatas.length == 3">
                                                            <div class="w-full flex">
                                                                <img src={{fileLink}}{{attach.fileId}} alt="image"
                                                                    class="w-full h-12rem cursor-pointer"
                                                                    style="object-fit: contain"
                                                                    (click)="imageClick(i,j)" />
                                                            </div>
                                                        </ng-container>
                                                        <ng-container *ngIf="data.attachmentPostDatas.length > 3">
                                                            <ng-container *ngIf="j == 3; else elsePict">
                                                                <div
                                                                    class="w-full flex justify-content-center align-content-center h-10rem overflow-hidden pb-1 relative">
                                                                    <img src={{fileLink}}{{attach.fileId}} alt="image"
                                                                        class="h-auto cursor-pointer"
                                                                        style="object-fit: cover"
                                                                        (click)="imageClick(i,j)" />
                                                                    <div class="absolute w-full h-full bg-black-alpha-90 opacity-80 flex justify-content-center align-items-center"
                                                                        (click)="imageClick(i,j)">
                                                                        <h1 class="text-white">
                                                                            {{data.attachmentPostDatas.length -3}} +
                                                                        </h1>
                                                                    </div>
                                                                </div>
                                                            </ng-container>
                                                            <ng-template #elsePict>
                                                                <div *ngIf=" j<=3"
                                                                    class="w-full flex justify-content-center align-content-center h-10rem overflow-hidden pb-1 relative">
                                                                    <img src={{fileLink}}{{attach.fileId}} alt="image"
                                                                        class="h-auto cursor-pointer"
                                                                        style="object-fit: cover"
                                                                        (click)="imageClick(i,j)" />
                                                                </div>
                                                            </ng-template>
                                                        </ng-container>
                                                    </ng-container>
                                                </div>
                                            </ng-template>
                                        </ng-container>
                                    </div>

                                    <ng-template #elsePoll>
                                        <div class="mt-3 w-full">
                                            <div class="card p-4 border-none bg-gray-50">
                                                <h6 class="mb-4">{{data.pollData.pollTitle}}</h6>
                                                <ng-container
                                                    *ngIf="data.pollData.isVoted || isExpired(data.pollData.endAt); else notVoted">
                                                    <ng-container
                                                        *ngFor="let poll of data.pollData.pollOptionDatas; index as pollIndex">
                                                        <ng-container *ngIf="poll.isVoted; else optionNotVoted">
                                                            <button pButton class="p-button-sm mb-2" type="button"
                                                                label={{poll.pollContent}} [disabled]="true"></button>
                                                        </ng-container>
                                                        <ng-template #optionNotVoted>
                                                            <button pButton class="p-button-outlined p-button-sm mb-2"
                                                                type="button" label={{poll.pollContent}}
                                                                [disabled]="true"></button>
                                                        </ng-template>
                                                    </ng-container>
                                                </ng-container>
                                                <ng-template #notVoted>
                                                    <ng-container
                                                        *ngFor="let poll of data.pollData.pollOptionDatas; index as pollIndex">
                                                        <button pButton class="p-button-outlined p-button-sm mb-2"
                                                            type="button" label={{poll.pollContent}}
                                                            (click)="clickVote(i,pollIndex)"></button>
                                                    </ng-container>
                                                </ng-template>
                                                <div class="mt-2">
                                                    <span class="text-sm mr-3">{{data.pollData.countVote}} votes</span>
                                                    <span class="text-end text-sm">Until 5 Day</span>
                                                </div>
                                            </div>
                                        </div>
                                    </ng-template>
                                </div>

                                <div class="grid mt-2">
                                    <div class="col-6">{{data.countLike}} Likes</div>
                                    <div class="col-6 text-end text-sm">{{data.countComment}} Comments</div>
                                </div>
                                <div class="grid border-top-1 border-gray-300 pt-2">
                                    <ng-container *ngIf="data.isLiked ;else elseBlock">
                                        <div class="px-3 py-3 hover:bg-blue-50 flex align-items-center cursor-pointer"
                                            (click)="clickUnLike(i)">
                                            <span class="font-semibold color-primary text-sm"><i
                                                    class="pi pi-thumbs-up-fill"></i> Like</span>
                                        </div>

                                    </ng-container>
                                    <ng-template #elseBlock>
                                        <div class="px-3 py-3 hover:bg-blue-50 flex align-items-center border-round-md cursor-pointer"
                                            (click)="clickLike(i)">
                                            <span class="font-semibold text-sm"><i class="pi pi-thumbs-up"></i>
                                                Like</span>
                                        </div>
                                    </ng-template>

                                    <ng-container *ngIf="data.isBookmarked; else notBookmarked">
                                        <div class="px-3 py-3 hover:bg-blue-50 flex align-items-center cursor-pointer"
                                            (click)="clickUnSave(i)">
                                            <span class="font-semibold color-primary"><i
                                                    class="pi pi-bookmark-fill"></i> Save</span>
                                        </div>
                                    </ng-container>
                                    <ng-template #notBookmarked>
                                        <div class="px-3 py-3 hover:bg-blue-50 flex align-items-center cursor-pointer"
                                            (click)="clickSave(i)">
                                            <span class="font-semibold"><i class="pi pi-bookmark"></i> Save</span>
                                        </div>

                                    </ng-template>
                                    <div class="px-3 py-3 hover:bg-blue-50 flex align-items-center cursor-pointer"
                                        (click)="clickCommentPost(i)">
                                        <span class="font-semibold"><i class="pi pi-comment"></i> Comment</span>
                                    </div>
                                </div>
                                <div *ngIf="data.commentStatus">
                                    <div class="flex mt-2">
                                        <div class="max-w-max mr-3"><img src="{{fileLink}}{{myFileId}}"
                                                class="border-circle w-2rem h-2rem" style="object-fit: cover"
                                                alt="profile picture">
                                        </div>
                                        <div class="w-full">
                                            <form [formGroup]="commentForm" (ngSubmit)="submitcomment(i)">
                                                <div class="flex flex-row align-content-center">
                                                    <input pInputText pAutoFocus
                                                        class="w-full p-inputtext-sm border-round-3xl text-sm"
                                                        [autofocus]="true" placeholder="Write a comment..."
                                                        formControlName="commentContent">
                                                    <p-button type="submit" class="ml-2" [hidden]="true">Send</p-button>
                                                </div>
                                                <small class="text-xs">Press enter to comment</small>
                                            </form>
                                        </div>
                                    </div>
                                    <div class="my-3">
                                        <span class="text-sm cursor-pointer hover:text-blue-500"
                                            *ngIf="data.moreComment==false" (click)="clickSeeComment(i)">
                                            View Comments
                                        </span>
                                        <span class="text-sm cursor-pointer hover:text-blue-500"
                                            *ngIf="data.moreComment" (click)="clickCloseComment(i)">
                                            Close Comments
                                        </span>
                                    </div>

                                    <div *ngIf="data.moreComment">
                                        <ng-container *ngFor="let comment of data.commentDatas; index as commentIndex">
                                            <ng-container *ngIf="!comment.editComment; else elseEditComment">
                                                <div class="flex mt-2">
                                                    <div class="max-w-max mr-3"> <img
                                                            class="border-circle w-2rem h-2rem"
                                                            style="object-fit: cover"
                                                            src="{{fileLink}}{{comment.fileId}}" alt="">
                                                    </div>
                                                    <div class="card border-none bg-gray-50 border-round-md py-1">
                                                        <div class="flex px-3">
                                                            <div class="w-full">
                                                                <p class="font-medium text-sm mb-0">{{comment.userName}}
                                                                </p>
                                                                <span class="text-xs">{{comment.createdAt |
                                                                    timeAgo}}</span>
                                                            </div>
                                                            <div class="inline-block justify-content-end relative ml-6"
                                                                *ngIf="data.userId==myUserId || comment.userId == myUserId">
                                                                <div class="flex align-items-center text-900 cursor-pointer hover:bg-gray-100"
                                                                    pStyleClass="@next" enterClass="hidden"
                                                                    leaveToClass="hidden" [hideOnOutsideClick]="true">
                                                                    <div
                                                                        class="cursor-pointer transition-all transition-duration-200">
                                                                        <i class="pi pi-ellipsis-h"></i>
                                                                    </div>
                                                                </div>
                                                                <div
                                                                    class="absolute right-0 shadow-2 border-round-lg w-12rem z-5 bg-white hidden">
                                                                    <ul class="list-none p-0 m-0">
                                                                        <li>
                                                                            <a *ngIf="comment.userId == myUserId && !editComment"
                                                                                class="block px-3 pt-2 pb-2 no-underline text-black-alpha-60 hover:bg-gray-100 hover:border-round-top-lg transition-all transition-duration-200 cursor-pointer"
                                                                                (click)="clickEditComment(i, commentIndex)">
                                                                                <span class="font-medium">Edit</span>
                                                                            </a>
                                                                        </li>
                                                                        <li>
                                                                            <a *ngIf="comment.userId == myUserId || data.userId==myUserId"
                                                                                class="block px-3 pt-2 pb-2 no-underline text-black-alpha-60 hover:bg-gray-100 hover:border-round-bottom-lg transition-all transition-duration-200 cursor-pointer"
                                                                                (click)="clickConfirmDeleteComment(i, commentIndex)">
                                                                                <span class="font-medium">Delete</span>
                                                                            </a>
                                                                        </li>
                                                                    </ul>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="px-3 mt-2">
                                                            <p class="text-sm mb-1 line-height-2">
                                                                {{comment.commentContent}} <em
                                                                    *ngIf="comment.version>0"><small>(edited)</small></em>
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </ng-container>
                                            <ng-template #elseEditComment>
                                                <div class="flex mt-2" *ngIf="comment.editComment">
                                                    <div class="max-w-max mr-3"><img src="{{fileLink}}{{myFileId}}"
                                                            class="border-circle w-2rem h-2rem"
                                                            style="object-fit: cover" alt="profile picture">
                                                    </div>
                                                    <div class="w-full">
                                                        <form [formGroup]="updateCommentForm"
                                                            (ngSubmit)="submitEditComment(i, commentIndex)">
                                                            <div class="flex flex-row align-content-center">
                                                                <input pInputText pAutoFocus
                                                                    class="w-full p-inputtext-sm border-round-3xl text-sm"
                                                                    [autofocus]="true" placeholder="Edit comment..."
                                                                    formControlName="commentContent">
                                                                <p-button type="submit" class="ml-2" [hidden]="true">
                                                                    Send
                                                                </p-button>
                                                            </div>
                                                            <small class="text-xs">Press enter to edit comment. Click
                                                                here to
                                                                <a class="text-primary cursor-pointer font-medium"
                                                                    style="text-decoration: none;"
                                                                    (click)="cancelEdit(i, commentIndex)">Cancel</a></small>
                                                        </form>
                                                    </div>
                                                </div>
                                            </ng-template>
                                        </ng-container>
                                        <span class="text-sm cursor-pointer hover:text-blue-500 mt-2"
                                            *ngIf="data.showMoreComment" (click)="seeMoreComment(i)">
                                            See More...
                                        </span>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </ng-container>

                    <div class="text-center" *ngIf="postLoading">
                        <p-progressSpinner></p-progressSpinner>
                    </div>
                </p-tabPanel>
            </p-tabView>
        </div>


        <!-- Side Content -->
        <div class="lg:col-4 lg:block hidden">
            <div class="">
                <right-content></right-content>
            </div>
        </div>
    </div>


    <!-- Create Post -->
    <p-dialog header="Create a Post" [breakpoints]="{'960px': '90vw'}" [style]="{width: '45vw'}" [(visible)]="showForm"
        [modal]="true" [draggable]="false" [resizable]="false">
        <form class="formgrid grid" [formGroup]="postForm" (ngSubmit)="submitPost()">
            <div class="field col-12">
                <span class="cursor-pointer hover:text-blue-500 mr-4" (click)="clickAddPhotos()" pTooltip="add a photo"
                    tooltipPosition="top"><i class="pi pi-images" style="font-size: 20px"></i> Create a Post</span>

                <span class="cursor-pointer hover:text-blue-500" (click)="clickCreatePoll()" pTooltip="add a photo"
                    tooltipPosition="top"><i class="pi pi-chart-bar" style="font-size: 20px"></i> Create a Poll</span>

            </div>
            <!-- Post Title -->
            <div class="field col-12">
                <label for="postTitle">Title<span class="text-red-500">*</span></label>
                <input pInputText class="w-full" type="text" id="postTitle" name="postTitle" formControlName="postTitle"
                    [maxlength]="100" required>
                <small class="p-error"
                    *ngIf="postForm.controls['postTitle'].errors?.['required'] && postForm.controls['postTitle'].touched">
                    Please input post title
                </small>
                <small class="p-error"
                    *ngIf="postForm.controls['postTitle'].errors?.['maxlength'] && postForm.controls['postTitle'].touched">
                    Title exceed maximum input (100 characters)
                </small>
            </div>
            <!-- Post Content -->
            <div class="field col-12">
                <label for="postContent">Content<span class="text-red-500">*</span></label>
                <textarea pInputTextarea [rows]="5" class="w-full scroll" id="postContent" [autoResize]="false"
                    name="postContent" formControlName="postContent" required></textarea>
                <small class="p-error"
                    *ngIf="postForm.controls['postContent'].errors?.['required'] && postForm.controls['postContent'].touched">
                    Please input post content
                </small>
            </div>

            <!-- Create Polling -->
            <div class="field col-12 mt-4" *ngIf="showCreatePolling">
                <h5 class="-mb-2">Polling</h5>
                <p-divider></p-divider>

                <div formGroupName="pollInsertReq">
                    <div class="field">
                        <label for="pollQuestion">Question<span class="text-red-500">*</span></label>
                        <textarea rows="2" [autoResize]="true" pInputTextarea class="w-full" id="pollQuestion"
                            name="pollQuestion" formControlName="pollTitle"></textarea>
                        <small class="p-error" *ngIf="pollTitle?.errors?.['required'] && pollTitle?.touched">
                            Please fill the polling question
                        </small>
                    </div>
                    <div formArrayName="pollOptionInsertReqs">
                        <ng-container *ngFor="let option of pollingOption.controls; index as i" [formGroupName]="i">
                            <div class="field">
                                <label for="pollOption">Option {{i+1}}<span class="text-red-500">*</span></label>
                                <div class="grid">
                                    <div class="col-10">
                                        <input pInputText class="w-full p-inputtext-sm" type="text" id="pollOption"
                                            name="pollOption" formControlName="pollContent" required>
                                        <small class="p-error" *ngIf="option.invalid && option.touched">
                                            Please fill the polling option
                                        </small>
                                    </div>
                                    <div class="col-2">
                                        <button pButton class="p-button-sm p-button-danger" *ngIf="i>1"
                                            (click)="removePoll(i)">Remove</button>
                                    </div>
                                </div>
                            </div>
                        </ng-container>
                    </div>
                    <!-- Add Option -->
                    <button pButton class="p-button-outlined p-button-sm" type="button" id="btnAddOption"
                        name="btnAddOption" (click)="addPoll()">Add Option</button>

                    <div class="field mt-4">
                        <label for="pollDuration">Expired<span class="text-red-500">*</span></label>
                        <p-calendar inputId="time" name="expiredAt" styleClass="w-full" [focusTrap]="true"
                            formControlName="endAt" [showTime]="true" [minDate]="minDateValue"></p-calendar>
                    </div>
                </div>
            </div>

            <!-- Upload Image -->
            <div class="field col-12" *ngIf="showUploadImg">
                <label for="image" class="mb-0">Upload Image</label>
                <small id="username1-help" class="block text-xs">**Please click upload button after choose image</small>

                <p-fileUpload #uploadComponent url="./upload.php" [multiple]="true" accept="image/*"
                    [customUpload]="true" (onSelect)="selectFile($event)" (uploadHandler)="fileUpload($event)">
                </p-fileUpload>
            </div>

            <div class="field-checkbox col-12 md:col-6" *ngIf="showUploadImg">
                <p-checkbox formControlName="isPremium" [binary]="true" inputId="binary" formControlName="isPremium">
                </p-checkbox>
                <label for="binary">Post as Premium</label>
            </div>

            <div class="col-12">
                <div class="flex gap-2 mt-5 justify-content-end">
                    <button pButton class="p-button-outlined p-button-sm" type="button" id="btnCancel" name="btnCancel"
                        (click)="showForm=false">Cancel</button>
                    <button pButton class="p-button-sm" type="submit" id="btnPost" name="btnPost"
                        [disabled]="uploaded">Post</button>
                </div>
            </div>
        </form>
    </p-dialog>



    <p-dialog header="Create a Post" [breakpoints]="{'960px': '90vw'}" [style]="{width: '45vw'}"
        [(visible)]="showEditForm" [modal]="true" [draggable]="false" [resizable]="false">
        <post-update></post-update>
    </p-dialog>

    <!-- Pop-up Premium -->
    <p-dialog header="Upgrade Premium" [breakpoints]="{'960px': '100vw'}" [style]="{width: '45vw'}"
        [(visible)]="premiumDialog" [modal]="true" [draggable]="false" [resizable]="false">

        <div class="grid mt-4">
            <div class="col-12 text-center">
                <li class="pi pi-lock" style="font-size: 29px"></li>
                <p>This post is only available to premium members.</p>
                <h5>Upgrade to Premium now !</h5>
            </div>
            <div class="col-12 text-center">
                <button pButton class="p-button-sm p-button-rounded" label="Join Now"
                    routerLink="/payment/premium"></button>
            </div>
        </div>
    </p-dialog>
</div>

<p-confirmDialog [style]="{width: '45vw'}" [breakpoints]="{'960px': '90vw'}" key="positionDialog"
    rejectButtonStyleClass="p-button-secondary p-button-sm"
    acceptButtonStyleClass="p-button-danger p-button-sm"></p-confirmDialog>